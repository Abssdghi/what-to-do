<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>WHAT TODO</title>
<style>
  img {
    user-select: none;
    user-drag: none;
    -moz-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    -webkit-user-drag: none;
    -ms-user-select: none;
  }
</style>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-zinc-200 h-screen flex items-center justify-center overflow-hidden p-8 select-none">
  <div class="flex flex-col items-center gap-10">
    <h1 class="text-4xl font-serif text-black">
      WHAT TO DO?
    </h1>
    <div id="card-container" class="relative w-80 h-[520px]">  
  </div>
</div>

<script>
const container = document.getElementById("card-container");
const STORAGE_KEY = "seen_cards_history";

const database = {
    "things": [
        {
        "id": 1,
        "img": "https://i.pinimg.com/736x/ae/30/64/ae30643125b9215894a15fefef0b6a1e.jpg",
        "title": "Go for a Walk",
        "description": "Nature is the best therapy."
        },
        {
        "id": 2,
        "img": "https://i.pinimg.com/1200x/04/86/76/04867621a89c35a68aa7648ccd367bea.jpg",
        "title": "Watch a movie",
        "description": "Escape into a different world."
        },
        {
        "id": 3,
        "img": "https://i.pinimg.com/736x/9c/28/75/9c2875a264a2e472e9203839ac5f8b11.jpg",
        "title": "Read a Book",
        "description": "Expand your mind. physical or digital, it doesn't matter."
        },
        {
        "id": 4,
        "img": "https://i.pinimg.com/736x/6a/95/52/6a9552c5ce404f3d218ff4d59f7c55c7.jpg",
        "title": "Call a friend",
        "description": "Reconnect and share some laughs."
        }
    ]
}

// Get Random Card Data
function getRandomCardFromDatabase() {
  const randomIndex = Math.floor(Math.random() * database.things.length);
  return database.things[randomIndex];
}

// Get Card Data with Seed (for consistent results)
function getRandomCardWithSeed(seed) {
  const randomIndex = seed % database.things.length;
  return database.things[randomIndex];
}

// Save History
function saveToHistory(data) {
  const old = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  old.push(data);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(old));
}

// Create Card
function createCard(zIndex) {
  const data = getRandomCardWithSeed(zIndex);

  const card = document.createElement("div");
  card.style.zIndex = zIndex;
  card.className = `
    absolute w-full h-full rounded-[50px] overflow-hidden
    shadow-2xl cursor-grab active:cursor-grabbing
    transition-transform bg-white
  `;

  card.innerHTML = `
    <div class="w-full h-full relative">
      <img src="${data.img}" class="w-full h-full object-cover drag-none"/>
      <div class="absolute bottom-0 w-full p-6 text-white bg-gradient-to-t from-black/80 to-transparent">
        <h2 class="text-3xl font-serif text-shadow-lg">${data.title}</h2>
        <p class="text-sm font-mono opacity-80 mt-1 text-shadow-lg ml-1">${data.description}</p>
      </div>
    </div>
  `;

  addDrag(card, data);
  container.appendChild(card);
}

// Drag + Touch
function addDrag(card, data) {
  let startX, startY, currentX=0, currentY=0;
  let dragging = false;

  const start = (x,y) => {
    dragging = true;
    startX = x;
    startY = y;
    card.style.transition = "none";
  };

  const move = (x,y) => {
    if(!dragging) return;
    currentX = x - startX;
    currentY = y - startY;

    card.style.transform = `
      translate(${currentX}px, ${currentY}px)
      rotate(${currentX * 0.05}deg)
    `;
  };

  const end = () => {
    if(!dragging) return;
    dragging = false;

    const threshold = 120;

    if(Math.abs(currentX) > threshold || Math.abs(currentY) > threshold) {
      saveToHistory(data);

      const dirX = currentX > 0 ? 1200 : -1200;
      const dirY = currentY > 0 ? 1200 : -1200;

      card.style.transition = "0.4s ease-out";
      card.style.transform = `translate(${dirX}px, ${dirY}px) rotate(${currentX*0.1}deg)`;

      setTimeout(()=>{
        card.remove();
      },400);
    } else {
      card.style.transition = "0.3s ease";
      card.style.transform = "translate(0,0) rotate(0)";
    }
  };

  // Mouse
  card.addEventListener("mousedown", e => start(e.clientX, e.clientY));
  document.addEventListener("mousemove", e => move(e.clientX, e.clientY));
  document.addEventListener("mouseup", end);

  // Touch
  card.addEventListener("touchstart", e => {
    const t = e.touches[0];
    start(t.clientX, t.clientY);
  });

  document.addEventListener("touchmove", e => {
    const t = e.touches[0];
    move(t.clientX, t.clientY);
  });

  document.addEventListener("touchend", end);
}

// Show History in Console
function showHistory() {
  const history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  console.log("Seen Cards History:", history);
}

// Create Initial Cards
let zIndexCounter = Math.floor(Math.random() * 1000) + 1000;
setInterval(() => {
    console.log(container.children.length);
    if (container.children.length < 4) {
        createCard(zIndexCounter);
        zIndexCounter -= 1;
    }
}, 500);

</script>

</body>
</html>